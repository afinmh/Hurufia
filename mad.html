<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mad - Hurufia</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/hukum.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="materi-detail-header">
        <div class="container">
            <div class="materi-title">
                <span class="arabic-letter">ا</span>
                <h1>Mad</h1>
            </div>
            <p class="subtitle">Pelajari hukum bacaan mad secara bertahap</p>
        </div>
    </header>

    <!-- Module buttons navigation -->
    <div class="module-buttons">
        <div class="container">
            <a href="materi.html" class="back-button" title="Kembali ke halaman materi">
                <i class="fas fa-arrow-left"></i>
            </a>
            <a href="nun.html" class="module-button">
                <span class="arabic-letter small">ن</span>
                Nun Mati
            </a>
            <a href="mim.html" class="module-button">
                <span class="arabic-letter small">م</span>
                Mim Mati
            </a>
            <a href="lam.html" class="module-button">
                <span class="arabic-letter small">ل</span>
                Lam Ta'rif
            </a>
            <a href="mad.html" class="module-button active">
                <span class="arabic-letter small">ا</span>
                Mad
            </a>
            <a href="tafkhim.html" class="module-button">
                <span class="arabic-letter small">ر</span>
                Tafkhim/Tarqiq
            </a>
            <a href="qolqolah.html" class="module-button">
                <span class="arabic-letter small">ق</span>
                Qolqolah
            </a>
        </div>
    </div>

    <section class="materi-content">
        <div class="container">
            <div class="step-navigation">
                <div class="step-indicator">
                    <div class="step active" data-step="1">Mad Thobi'i</div>
                    <div class="step" data-step="2">Mad Wajib Muttasil</div>
                    <div class="step" data-step="3">Mad Jaiz Munfasil</div>
                    <div class="step" data-step="4">Tes Pemahaman</div>
                </div>
            </div>

            <div class="content-section active" id="step-1">
                <h2>Mad Thobi'i</h2>
                <div class="hukum-content">
                    <div class="hukum-info">
                        <h3>Pengertian</h3>
                        <p>Mad Thobi'i adalah mad yang terjadi ketika huruf mad (ا، و، ي) berharakat fathah, dhommah, atau kasrah, dan tidak diikuti oleh hamzah atau sukun.</p>
                    </div>
                    <div class="hukum-info">
                        <h3>Cara Membaca</h3>
                        <p>Huruf mad dibaca panjang selama 2 harakat (1 alif).</p>
                    </div>
                    <div class="arabic-example">
                        <h3>Contoh Bacaan</h3>
                        <p>قَالَ</p>
                        <p>يَقُولُ</p>
                        <p>قِيلَ</p>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="next-button" onclick="nextStep(1)">Selanjutnya <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <div class="content-section" id="step-2">
                <h2>Mad Wajib Muttasil</h2>
                <div class="hukum-content">
                    <div class="hukum-info">
                        <h3>Pengertian</h3>
                        <p>Mad Wajib Muttasil adalah mad yang terjadi ketika huruf mad (ا، و، ي) diikuti oleh hamzah dalam satu kata.</p>
                    </div>
                    <div class="hukum-info">
                        <h3>Cara Membaca</h3>
                        <p>Huruf mad dibaca panjang selama 4-5 harakat (2-2.5 alif).</p>
                    </div>
                    <div class="arabic-example">
                        <h3>Contoh Bacaan</h3>
                        <p>سَوَاءٌ</p>
                        <p>جَاءَ</p>
                        <p>سُوءَ</p>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="prev-button" onclick="prevStep(2)"><i class="fas fa-arrow-left"></i> Sebelumnya</button>
                    <button class="next-button" onclick="nextStep(2)">Selanjutnya <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <div class="content-section" id="step-3">
                <h2>Mad Jaiz Munfasil</h2>
                <div class="hukum-content">
                    <div class="hukum-info">
                        <h3>Pengertian</h3>
                        <p>Mad Jaiz Munfasil adalah mad yang terjadi ketika huruf mad (ا، و، ي) diikuti oleh hamzah dalam kata yang berbeda.</p>
                    </div>
                    <div class="hukum-info">
                        <h3>Cara Membaca</h3>
                        <p>Huruf mad dibaca panjang selama 2-4-5 harakat (1-2-2.5 alif).</p>
                    </div>
                    <div class="arabic-example">
                        <h3>Contoh Bacaan</h3>
                        <p>يَا أَيُّهَا</p>
                        <p>إِنَّا أَنْزَلْنَاهُ</p>
                        <p>قَالَ آمَنْتُ</p>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="prev-button" onclick="prevStep(3)"><i class="fas fa-arrow-left"></i> Sebelumnya</button>
                    <button class="next-button" onclick="nextStep(3)">Selanjutnya <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <div class="content-section" id="step-4">
                <h2>Tes Pemahaman</h2>
                <div class="hukum-content">
                    <div class="hukum-info">
                        <h3>Selamat!</h3>
                        <p>Anda telah menyelesaikan semua materi tentang Mad. Mari kita uji pemahaman Anda dengan beberapa pertanyaan.</p>
                    </div>
                    
                    <div class="test-container">
                        <div class="test-question">
                            <h3>Pertanyaan 1</h3>
                            <p>Mad Thobi'i terjadi ketika huruf mad...</p>
                            <div class="test-options">
                                <label>
                                    <input type="radio" name="q1" value="a">
                                    Diikuti oleh hamzah dalam satu kata
                                </label>
                                <label>
                                    <input type="radio" name="q1" value="b">
                                    Berharakat fathah, dhommah, atau kasrah
                                </label>
                                <label>
                                    <input type="radio" name="q1" value="c">
                                    Diikuti oleh hamzah dalam kata berbeda
                                </label>
                            </div>
                        </div>

                        <div class="test-question">
                            <h3>Pertanyaan 2</h3>
                            <p>Contoh bacaan yang termasuk Mad Wajib Muttasil adalah...</p>
                            <div class="test-options">
                                <label>
                                    <input type="radio" name="q2" value="a">
                                    قَالَ
                                </label>
                                <label>
                                    <input type="radio" name="q2" value="b">
                                    سَوَاءٌ
                                </label>
                                <label>
                                    <input type="radio" name="q2" value="c">
                                    يَا أَيُّهَا
                                </label>
                            </div>
                        </div>

                        <div class="test-question">
                            <h3>Pertanyaan 3</h3>
                            <p>Mad Jaiz Munfasil dibaca panjang selama...</p>
                            <div class="test-options">
                                <label>
                                    <input type="radio" name="q3" value="a">
                                    2 harakat
                                </label>
                                <label>
                                    <input type="radio" name="q3" value="b">
                                    4-5 harakat
                                </label>
                                <label>
                                    <input type="radio" name="q3" value="c">
                                    2-4-5 harakat
                                </label>
                            </div>
                        </div>

                        <div class="test-question">
                            <h3>Pertanyaan 4</h3>
                            <p>Huruf-huruf mad adalah...</p>
                            <div class="test-options">
                                <label>
                                    <input type="radio" name="q4" value="a">
                                    ا، و، ي
                                </label>
                                <label>
                                    <input type="radio" name="q4" value="b">
                                    ا، ب، ت، ث
                                </label>
                                <label>
                                    <input type="radio" name="q4" value="c">
                                    خ، ص، ض، غ
                                </label>
                            </div>
                        </div>

                        <div class="test-question">
                            <h3>Pertanyaan 5</h3>
                            <p>Mad Wajib Muttasil terjadi ketika...</p>
                            <div class="test-options">
                                <label>
                                    <input type="radio" name="q5" value="a">
                                    Huruf mad diikuti oleh hamzah dalam satu kata
                                </label>
                                <label>
                                    <input type="radio" name="q5" value="b">
                                    Huruf mad berharakat fathah
                                </label>
                                <label>
                                    <input type="radio" name="q5" value="c">
                                    Huruf mad diikuti oleh hamzah dalam kata berbeda
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="test-result" style="display: none;">
                        <h3>Hasil Tes</h3>
                        <p>Skor Anda: <span id="score">0</span>/5</p>
                        <div class="result-message"></div>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="prev-button" onclick="prevStep(4)"><i class="fas fa-arrow-left"></i> Sebelumnya</button>
                    <button class="check-button" onclick="checkAnswers()">Periksa Jawaban</button>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-main">
                    <div class="footer-brand">
                        <a href="index.html" class="logo">
                            <i class="fas fa-book-quran"></i>
                            Hurufia
                        </a>
                        <p>Platform pembelajaran tajwid online terbaik untuk meningkatkan kualitas bacaan Al-Qur'an Anda.</p>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2024 Hurufia. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <style>
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-icon {
            font-size: 3rem;
            color: #3498db;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 1rem;
        }

        .modal-message {
            color: #4a5568;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .modal-button {
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-confirm {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
        }

        .modal-cancel {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .modal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .test-options label {
            position: relative;
            padding-right: 2rem;
        }

        .answer-feedback {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
        }

        .correct {
            color: #2ecc71;
        }

        .incorrect {
            color: #e74c3c;
        }

        .test-question {
            position: relative;
        }

        .question-feedback {
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
        }

        .question-feedback.correct {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }

        .question-feedback.incorrect {
            background: rgba(231, 76, 60, 0.1);
            color: #c0392b;
        }

        /* Module buttons styling */
        .module-buttons {
            background: #f7fafc;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .module-buttons .container {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            gap: 0.5rem;
            padding: 0.5rem 20px;
            scrollbar-width: none;
        }

        .module-buttons .container::-webkit-scrollbar {
            display: none;
        }

        .module-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: white;
            border-radius: 50px;
            text-decoration: none;
            color: #4a5568;
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .module-button.active {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            box-shadow: 0 2px 10px rgba(52, 152, 219, 0.3);
        }

        .module-button:hover:not(.active) {
            background: #f1f5f9;
            transform: translateY(-2px);
        }

        .arabic-letter.small {
            font-size: 1.2rem;
            line-height: 1;
            color: #3498db;
        }

        .module-button.active .arabic-letter.small {
            color: white;
        }

        /* Responsive module buttons */
        @media (max-width: 768px) {
            .module-button {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .arabic-letter.small {
                font-size: 1rem;
            }
        }

        /* Notification styling */
        .notification {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 30px;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        .notification i {
            font-size: 1.2rem;
        }
    </style>

    <div class="modal-overlay" id="confirmModal">
        <div class="modal">
            <i class="fas fa-question-circle modal-icon"></i>
            <h3 class="modal-title">Konfirmasi</h3>
            <p class="modal-message">Apakah Anda yakin ingin melanjutkan ke Tes Pemahaman? Pastikan Anda telah memahami semua materi sebelumnya.</p>
            <div class="modal-buttons">
                <button class="modal-button modal-cancel" onclick="closeModal()">Kembali</button>
                <button class="modal-button modal-confirm" onclick="confirmTest()">Lanjutkan</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="answerModal">
        <div class="modal">
            <i class="fas fa-exclamation-circle modal-icon"></i>
            <h3 class="modal-title">Perhatian</h3>
            <p class="modal-message">Silakan jawab semua pertanyaan terlebih dahulu!</p>
            <div class="modal-buttons">
                <button class="modal-button modal-confirm" onclick="closeModal()">Baik</button>
            </div>
        </div>
    </div>

    <script src="js/progress.js"></script>
    <script>
        // Module ID
        const moduleId = 'mad';
        
        // Check for previous progress and load it
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedProgress();
        });

        function loadSavedProgress() {
            const progress = getModuleProgress(moduleId);
            
            // If there's saved progress, highlight completed steps
            if (progress && progress.completedSteps > 0) {
                // Mark completed steps in the navigation
                for (let i = 1; i <= progress.completedSteps && i < 3; i++) {
                    document.querySelector(`.step[data-step="${i}"]`).classList.add('completed');
                }
                
                // If module is fully completed, show completion notice
                if (progress.completed) {
                    showNotification('Modul ini telah selesai dengan skor ' + progress.score + '/5');
                }
            }
        }

        function showStep(stepNumber) {
            // Hide all steps
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected step
            document.getElementById(`step-${stepNumber}`).classList.add('active');
            
            // Update step indicators
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
                if (parseInt(step.dataset.step) === stepNumber) {
                    step.classList.add('active');
                }
            });

            // Track step completion in local storage
            trackStepCompletion(moduleId, stepNumber);

            // Scroll to top
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        function nextStep(currentStep) {
            if (currentStep < 4) {
                if (currentStep === 3) {
                    showModal('confirmModal');
                } else {
                    document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('completed');
                    showStep(currentStep + 1);
                }
            }
        }

        function prevStep(currentStep) {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal() {
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.style.display = 'none';
            });
        }

        function confirmTest() {
            document.querySelector(`.step[data-step="3"]`).classList.add('completed');
            showStep(4);
            closeModal();
        }

        function checkAnswers() {
            const answers = {
                q1: 'b', // Mad Thobi'i - Berharakat fathah, dhommah, atau kasrah
                q2: 'b', // Mad Wajib Muttasil - سَوَاءٌ
                q3: 'c', // Mad Jaiz Munfasil - 2-4-5 harakat
                q4: 'a', // Huruf-huruf mad - ا، و، ي
                q5: 'a'  // Mad Wajib Muttasil - Diikuti oleh hamzah dalam satu kata
            };

            let score = 0;
            let allAnswered = true;

            // Reset previous feedback
            document.querySelectorAll('.answer-feedback').forEach(feedback => feedback.remove());
            document.querySelectorAll('.question-feedback').forEach(feedback => feedback.remove());

            // Check each question
            for (let i = 1; i <= 5; i++) {
                const selectedAnswer = document.querySelector(`input[name="q${i}"]:checked`);
                if (!selectedAnswer) {
                    allAnswered = false;
                    break;
                }

                const questionDiv = document.querySelector(`.test-question:nth-child(${i})`);
                const labels = questionDiv.querySelectorAll('label');
                
                // Add feedback icons to each option
                labels.forEach(label => {
                    const feedback = document.createElement('span');
                    feedback.className = 'answer-feedback';
                    const input = label.querySelector('input');
                    
                    if (input.value === answers[`q${i}`]) {
                        feedback.innerHTML = '<i class="fas fa-check"></i>';
                        feedback.classList.add('correct');
                        feedback.title = 'Jawaban Benar';
                    } else if (input.checked) {
                        feedback.innerHTML = '<i class="fas fa-times"></i>';
                        feedback.classList.add('incorrect');
                        feedback.title = 'Jawaban Salah';
                    }
                    label.appendChild(feedback);
                });

                // Add question feedback
                const questionFeedback = document.createElement('div');
                questionFeedback.className = 'question-feedback';
                if (selectedAnswer.value === answers[`q${i}`]) {
                    score++;
                    questionFeedback.classList.add('correct');
                    questionFeedback.innerHTML = `
                        <i class="fas fa-check-circle"></i> 
                        <strong>Jawaban Anda benar!</strong>
                        <p>${getExplanation(i)}</p>
                    `;
                } else {
                    questionFeedback.classList.add('incorrect');
                    questionFeedback.innerHTML = `
                        <i class="fas fa-times-circle"></i> 
                        <strong>Jawaban Anda kurang tepat.</strong>
                        <p>${getExplanation(i)}</p>
                    `;
                }
                questionDiv.appendChild(questionFeedback);

                // Disable all inputs after checking
                labels.forEach(label => {
                    label.querySelector('input').disabled = true;
                });
            }

            if (!allAnswered) {
                showModal('answerModal');
                return;
            }

            // Show result
            const resultDiv = document.querySelector('.test-result');
            const scoreSpan = document.getElementById('score');
            const messageDiv = document.querySelector('.result-message');
            const checkButton = document.querySelector('.check-button');

            resultDiv.style.display = 'block';
            scoreSpan.textContent = score;

            if (score >= 3) {
                messageDiv.innerHTML = '<p>Selamat! Anda telah memahami materi Mad dengan baik.</p>';
                checkButton.textContent = 'Selesai';
                checkButton.classList.remove('check-button');
                checkButton.classList.add('finish-button');
                checkButton.onclick = function() {
                    window.location.href = 'materi.html';
                };
            } else {
                messageDiv.innerHTML = '<p>Anda perlu mempelajari kembali materi Mad. Jangan menyerah!</p>';
                checkButton.textContent = 'Ulangi';
                checkButton.classList.remove('check-button');
                checkButton.classList.add('retry-button');
                checkButton.onclick = function() {
                    // Reset all radio buttons and feedback
                    document.querySelectorAll('input[type="radio"]').forEach(radio => {
                        radio.checked = false;
                        radio.disabled = false;
                    });
                    document.querySelectorAll('.answer-feedback').forEach(feedback => feedback.remove());
                    document.querySelectorAll('.question-feedback').forEach(feedback => feedback.remove());
                    // Hide result
                    resultDiv.style.display = 'none';
                    // Reset button
                    checkButton.textContent = 'Periksa Jawaban';
                    checkButton.classList.remove('retry-button');
                    checkButton.classList.add('check-button');
                    checkButton.onclick = checkAnswers;
                };
            }

            // Scroll to result
            resultDiv.scrollIntoView({ behavior: 'smooth' });

            // Add progress tracking for completed test
            if (score >= 3) {
                // Save progress to local storage
                completeModule(moduleId, score, true);
                
                // Show success notification
                showNotification('Modul selesai! Skor: ' + score + '/5');
            }
        }

        function getExplanation(questionNumber) {
            const explanations = {
                1: "Mad Thobi'i terjadi ketika huruf mad (ا، و، ي) berharakat fathah, dhommah, atau kasrah, dan tidak diikuti oleh hamzah atau sukun.",
                2: "Contoh bacaan 'سَوَاءٌ' termasuk dalam hukum Mad Wajib Muttasil karena huruf mad (و) diikuti oleh hamzah dalam satu kata.",
                3: "Mad Jaiz Munfasil dibaca panjang selama 2-4-5 harakat (1-2-2.5 alif), tergantung pada qira'ah yang digunakan.",
                4: "Huruf-huruf mad adalah ا، و، ي. Huruf-huruf ini memiliki sifat memanjang ketika berharakat fathah, dhommah, atau kasrah.",
                5: "Mad Wajib Muttasil terjadi ketika huruf mad diikuti oleh hamzah dalam satu kata, seperti dalam kata 'سَوَاءٌ'."
            };
            return explanations[questionNumber] || '';
        }

        // Close modal when clicking outside
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
        });

        // Initialize first step
        showStep(1);
    </script>
</body>
</html>